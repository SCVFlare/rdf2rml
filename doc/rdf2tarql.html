<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>rdf2tarql - Convert RDF examples to TARQL scripts</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a>
    <ul>
      <li><a href="#RDF-Model">RDF Model</a></li>
      <li><a href="#Generated-Construct">Generated Construct</a></li>
      <li><a href="#Generated-Binds">Generated Binds</a></li>
      <li><a href="#Prerequisites">Prerequisites</a></li>
      <li><a href="#Limitations">Limitations</a></li>
    </ul>
  </li>
  <li><a href="#SEE-ALSO">SEE ALSO</a></li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>rdf2tarql - Convert RDF examples to TARQL scripts</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code>  perl rdf2tarql.pl model.ttl &gt; model.tarql</code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p><b>rdf2tarql</b> converts an RDF example with embedded CSV column names into a TARQL script (query). <a href="http://tarql.github.io/">TARQL</a> is a high-speed streaming convertor from CSV to RDF. We&#39;ve used it to convert huge files (over 10M rows, 145 columns) using complex TARQL queries (480 lines: 110 prefixes, 33 nodes, 250 triples, 110 binds).</p>

<h2 id="RDF-Model">RDF Model</h2>

<p>Typically the example is an <b>rdfpuml</b> model that uses embedded column names in URLs and attribute values.</p>

<p>Consider the following example about persons (customers):</p>

<pre><code>    &lt;person/(customer_id)&gt; a :NaturalPerson;
      :id &quot;(customer_id)&quot;;
      :firstName &quot;(first_name)&quot;;
      :lastName &quot;(last_name)&quot;;
      :gender &quot;(gender)&quot;;
      :religion &quot;(religion)&quot;;
      :hasAddress &lt;person/(customer_id)/address&gt;;
      :hasEvent  &lt;person/(customer_id)/birth&gt;;
      :hasEvent  &lt;person/(customer_id)/education&gt;.

    &lt;person/(customer_id)/address&gt; a :Address;
      :houseNumber &quot;(house_number)&quot;;
      :street &quot;(street)&quot;;
      :postalCode &quot;(postal_code)&quot;;
      :city &lt;country/(country)/city/urlify(city)&gt;;
      :country &lt;country/(country)&gt;.

    &lt;country/(country)/city/urlify(city)&gt; a :City; :country &lt;country/(country)&gt;; :name &quot;(city)&quot;.

    &lt;country/(country)&gt; a :Country; :code &quot;(country)&quot;.

    &lt;person/(customer_id)/birth&gt; a :BirthEvent; :hasDate &quot;(date_of_birth)&quot;^^xsd:date.

    &lt;person/(customer_id)/education&gt; a :EducationEvent;
      :hasDate &quot;(enrollment_date)&quot;^^xsd:date;
      :university &lt;university/urlify(university)&gt;;
      :degree &lt;degree/urlify(education_degree)&gt;.</code></pre>

<h2 id="Generated-Construct">Generated Construct</h2>

<p>The generated TARQL consists of two parts. First is a CONSTRUCT that&#39;s very similar to the example (model graph):</p>

<pre><code>  construct {
    ?person_URL a :NaturalPerson;
      :id ?customer_id;
      :firstName ?first_name;
      :lastName ?last_name;
      :gender ?gender;
      :religion ?religion;
      :hasAddress ?person_address_URL;
      :hasEvent  ?person_birth_URL;
      :hasEvent  ?person_education_URL.

    ?person_address_URL a :Address;
      :houseNumber ?house_number;
      :street ?street;
      :postalCode ?postal_code;
      :city ?country_city_URL;
      :country ?country_URL.

    ?country_city_URL a :City; :country ?country_URL; :name ?city.

    ?country_URL a :Country; :code ?country.

    ?person_birth_URL a :BirthEvent; :hasDate ?DATE_OF_BIRTH.

    ?person_education_URL a :EducationEvent;
      :hasDate ?ENROLLMENT_DATE;
      :university ?university_URL;
      :degree ?degree_URL.

    ?university_URL a :University; :name ?university.
    ?degree_URL a :AcademicDegree; :name ?education_degree.</code></pre>

<h2 id="Generated-Binds">Generated Binds</h2>

<p>Then come a bunch of bindings generated by:</p>

<dl>

<dt id="Using-the-CSV-fields-eg-customer_id">Using the CSV fields (eg <i>?customer_id</i>),</dt>
<dd>

</dd>
<dt id="Computing-URLs-from-patterns-eg-person_address_URL">Computing URLs from patterns (eg <i>?person_address_URL</i>),</dt>
<dd>

</dd>
<dt id="Implementing-a-urlify-function-that-replaces-consecutive-punctuation-with-a-single-_-and-removes-leading-trailing-punctuation-eg-CITY-then-country_city_URL">Implementing a <i>urlify()</i> function that replaces consecutive punctuation with a single <i>_</i> and removes leading/trailing punctuation (eg <i>?CITY</i> then <i>?country_city_URL</i>)</dt>
<dd>

</dd>
<dt id="Implementing-datatype-casting-using-strdt-eg-DATE_OF_BIRTH">Implementing datatype casting using <i>strdt()</i> (eg <i>?DATE_OF_BIRTH</i>)</dt>
<dd>

</dd>
</dl>

<p>All these binds are generated automatically using some simple conventions:</p>

<dl>

<dt id="URL-variables-are-named-using-the-constant-parts-eg-person_birth-and-appending-_URL">URL variables are named using the constant parts (eg <i>?person_birth</i>) and appending <i>_URL</i></dt>
<dd>

</dd>
<dt id="Transformed-variables-are-rendered-in-uppercase-eg-CITY-DATE_OF_BIRTH">Transformed variables are rendered in uppercase (eg <i>?CITY, ?DATE_OF_BIRTH</i>)</dt>
<dd>

</dd>
</dl>

<p>Here is the result:</p>

<pre><code>  } where {
    bind(iri(concat(&quot;person/&quot;,?customer_id)) as ?person_URL)
    bind(iri(concat(&quot;person/&quot;,?customer_id,&quot;/address&quot;)) as ?person_address_URL)
    bind(iri(concat(&quot;person/&quot;,?customer_id,&quot;/birth&quot;)) as ?person_birth_URL)
    bind(iri(concat(&quot;person/&quot;,?customer_id,&quot;/education&quot;)) as ?person_education_URL)
    bind(replace(replace(replace(?city,&#39;[^\\p{L}\\p{N}]+&#39;,&#39;_&#39;),&#39;^_&#39;,&#39;&#39;),&#39;_$&#39;,&#39;&#39;) as ?CITY)
    bind(iri(concat(&quot;country/&quot;,?country,&quot;/city/&quot;,?CITY)) as ?country_city_URL)
    bind(iri(concat(&quot;country/&quot;,?country)) as ?country_URL)
    bind(strdt(?date_of_birth,xsd:date) as ?DATE_OF_BIRTH)
    bind(strdt(?enrollment_date,xsd:date) as ?ENROLLMENT_DATE)
    bind(replace(replace(replace(?university,&#39;[^\\p{L}\\p{N}]+&#39;,&#39;_&#39;),&#39;^_&#39;,&#39;&#39;),&#39;_$&#39;,&#39;&#39;) as ?UNIVERSITY)
    bind(iri(concat(&quot;university/&quot;,?UNIVERSITY)) as ?university_URL)
    bind(replace(replace(replace(?education_degree,&#39;[^\\p{L}\\p{N}]+&#39;,&#39;_&#39;),&#39;^_&#39;,&#39;&#39;),&#39;_$&#39;,&#39;&#39;) as ?EDUCATION_DEGREE)
    bind(iri(concat(&quot;degree/&quot;,?EDUCATION_DEGREE)) as ?degree_URL)
  }</code></pre>

<h2 id="Prerequisites">Prerequisites</h2>

<p><a href="https://github.com/tarql/tarql/releases">TARQL</a>: tested with version 1.2-SNAPSHOT, BUILD_DATE: 2017-12-07T13:33:10Z</p>

<p>See <i>test/customer</i> for an example (includes a Makefile for make).</p>

<h2 id="Limitations">Limitations</h2>

<p>Don&#39;t use uppercase in field names as that may conflict with generated variable names.</p>

<p>Supports only one simple function <i>urlify()</i>, more should be added.</p>

<p>Non-ASCII characters in IRIs get converted to ugly escapes.</p>

<h1 id="SEE-ALSO">SEE ALSO</h1>

<p><b>rdfpuml</b>: a tool that generates PlantUML diagrams from RDF examples.</p>

<p><b>rdf2rml</b>: a tool that generates R2RML transformations from RDF examples.</p>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Vladimir Alexiev, Ontotext Corp</p>

<p>Last update: 9-Jun-2020</p>


</body>

</html>


